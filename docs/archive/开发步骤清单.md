# 《关都文字对战》开发步骤清单

## 🎉 当前项目状态：v3.0 已完成

**版本信息**：v3.0
**最后更新**：2025-11-08
**当前状态**：✅ MVP完成 + 商店/道具/捕捉系统完成

### 已完成的主要功能
- ✅ 完整的战斗系统（回合制1v1对战）
- ✅ 御三家选择系统（小火龙、杰尼龟、妙蛙种子）
- ✅ 属性克制系统（火克草、水克火、草克水等）
- ✅ 成长系统（经验获取、升级、进化）
- ✅ **商店系统**（购买药品和精灵球）
- ✅ **道具系统**（8种道具：4种药品 + 4种精灵球）
- ✅ **捕捉系统**（捕捉野生宝可梦）
- ✅ **队伍管理**（最多6只宝可梦，支持切换出战）
- ✅ **宝可梦盒子**（无限容量存储捕获的宝可梦）
- ✅ 训练家对战系统（8位训练家）
- ✅ 金币系统
- ✅ 本地存档系统（localStorage）
- ✅ 响应式UI（支持电脑/手机/平板）
- ✅ 151只宝可梦完整数据

### 技术架构
- **前端**：HTML5 + CSS3 + JavaScript (ES6)
- **样式**：Tailwind CSS + 自定义样式
- **存储**：localStorage（版本3.0，向后兼容2.0）
- **模块化**：8个JavaScript模块 + 2个数据文件

### 文件结构（当前）
```
pokemon-game/
├── index.html                      # 游戏主页面
├── styles.css                      # 样式文件
├── scripts/
│   ├── data.js                    # 游戏数据（151只宝可梦、技能、属性克制表）
│   ├── move.js                    # Move类
│   ├── item.js                    # Item类和道具数据 ✨v3.0新增
│   ├── pokemon.js                 # Pokemon类
│   ├── npc.js                     # NPC和训练家系统
│   ├── battle.js                  # Battle类和AI系统
│   ├── gameState.js               # 游戏状态管理（v3.0：队伍、背包、盒子）
│   ├── ui.js                      # UI控制模块
│   ├── shop.js                    # 商店系统 ✨v3.0新增
│   └── main.js                    # 主程序入口
├── pokemon_data_generated.json    # 151只宝可梦完整数据
├── pokemon_data_generated.js      # 151只宝可梦完整数据（JS格式）
├── 开发文档/                      # 完整的开发文档
└── README.md                      # 项目说明文档
```

---

## 📋 使用说明

这是一份**从零到完成的任务清单**，按顺序完成每一步，你就能做出完整的游戏！

**如何使用**：
- ✅ 完成一项就打勾
- 🔄 遇到问题就标记，稍后解决
- 📝 每完成一个阶段就测试一次

**注意**：下方阶段0-10是原始MVP开发计划，**已全部完成**。v3.0额外功能见本文档末尾。

---

## 📁 阶段0：准备工作（0.5天）

### 环境准备
- [ ] 安装代码编辑器（推荐VS Code）
- [ ] 安装浏览器（推荐Chrome，方便调试）
- [ ] 创建项目文件夹`pokemon-game`
- [ ] 学习基础HTML、CSS、JavaScript（如果完全不懂）

### 文件结构创建
- [ ] 创建 `index.html`
- [ ] 创建 `styles.css`
- [ ] 创建 `scripts/` 文件夹
- [ ] 在 `scripts/` 中创建以下文件：
  - [ ] `data.js`
  - [ ] `pokemon.js`
  - [ ] `move.js`
  - [ ] `battle.js`
  - [ ] `gameState.js`
  - [ ] `ui.js`
  - [ ] `main.js`

### 测试环境
- [ ] 双击 `index.html` 能在浏览器打开
- [ ] F12打开开发者工具，能看到Console面板
- [ ] 在Console输入 `console.log('测试')` 能看到输出

---

## 📁 阶段1：创建基础HTML结构（1天）

### 1.1 创建HTML骨架
参考：《开发文档-前端界面开发.md》第1节

- [ ] 复制完整的HTML结构到 `index.html`
- [ ] 添加 `<meta viewport>` 标签（手机适配）
- [ ] 链接 `styles.css` 文件
- [ ] 链接所有JavaScript文件（注意顺序！）

### 1.2 测试HTML
- [ ] 在浏览器打开，能看到标题"关都文字对战：初始冒险"
- [ ] 能看到初始选择界面（3个按钮）
- [ ] F12检查Console，没有红色错误

---

## 📁 阶段2：创建CSS样式（1-2天）

### 2.1 全局样式
参考：《开发文档-前端界面开发.md》第2节

- [ ] 复制全局样式（`* {}` 和 `body {}`）到 `styles.css`
- [ ] 设置游戏容器样式（`#game-container`）
- [ ] 测试：刷新浏览器，背景应该有渐变色

### 2.2 界面样式
- [ ] 添加标题栏样式（`#game-header`）
- [ ] 添加初始选择界面样式（`.starter-btn`等）
- [ ] 添加主界面样式（`#player-status`、`#message-box`等）
- [ ] 添加战斗界面样式（`.status-box`、`#battle-log`等）
- [ ] 测试：所有按钮应该有hover效果

### 2.3 响应式样式
- [ ] 添加手机端适配（`@media (max-width: 600px)`）
- [ ] 测试：在手机浏览器或浏览器的设备模拟器中查看
- [ ] 确保按钮在手机上够大（≥65px高）
- [ ] 确保文字在手机上够大（≥18px）

### 2.4 动画效果
- [ ] 添加淡入动画（`@keyframes fadeIn`）
- [ ] 添加HP条动画（`@keyframes hpShake`）
- [ ] 添加战斗日志滑入动画（`@keyframes slideIn`）
- [ ] 测试：切换界面应该有平滑过渡

---

## 📁 阶段3：创建游戏数据（1-2天）

### 3.1 属性克制表
参考：《开发文档-数据结构设计.md》第3节

在 `data.js` 中：
- [ ] 创建 `TYPE_CHART` 对象
- [ ] 添加火、水、草、电、普通等属性的克制关系
- [ ] 测试：在Console输入 `TYPE_CHART['火']['草']` 应该返回 `2.0`

### 3.2 经验值等级表
参考：《开发文档-数据结构设计.md》第4节

- [ ] 创建 `EXP_TABLE` 对象（1-50级）
- [ ] 测试：`EXP_TABLE[16]` 应该返回 `4096`

### 3.3 技能数据
参考：《开发文档-数据结构设计.md》第2节

- [ ] 创建 `MOVE_DATA` 对象
- [ ] 添加以下技能（最少）：
  - [ ] 火花（火系攻击）
  - [ ] 摇尾巴（降防御）
  - [ ] 水枪（水系攻击）
  - [ ] 缩入壳中（升防御）
  - [ ] 藤鞭（草系攻击）
  - [ ] 瞪眼（降防御）
  - [ ] 龙之怒（固定40伤害，可简化为普通攻击）
  - [ ] 撞击（普通系攻击）
- [ ] 测试：`MOVE_DATA['ember']` 能返回完整数据

### 3.4 宝可梦数据
参考：《开发文档-数据结构设计.md》第1节和第9节

- [ ] 创建 `POKEMON_DATA` 对象
- [ ] 添加御三家数据：
  - [ ] 小火龙（charmander）
  - [ ] 杰尼龟（squirtle）
  - [ ] 妙蛙种子（bulbasaur）
- [ ] 添加它们的进化形态：
  - [ ] 火恐龙（charmeleon）
  - [ ] 喷火龙（charizard）
  - [ ] 卡咪龟（wartortle）
  - [ ] 水箭龟（blastoise）
  - [ ] 妙蛙草（ivysaur）
  - [ ] 妙蛙花（venusaur）
- [ ] 添加野生宝可梦数据（最少5种）：
  - [ ] 绿毛虫（caterpie）
  - [ ] 小拉达（rattata）
  - [ ] 波波（pidgey）
  - [ ] 皮卡丘（pikachu）（可选）
  - [ ] 穿山鼠（sandshrew）（可选）
- [ ] 测试：`POKEMON_DATA['charmander']` 能返回完整数据

### 3.5 野生宝可梦生成池
参考：《开发文档-数据结构设计.md》第5节

- [ ] 创建 `WILD_POKEMON_POOL` 数组
- [ ] 为每个野生宝可梦设置等级范围和权重
- [ ] 测试：数组至少有5个条目

---

## 📁 阶段4：实现类和核心逻辑（3-4天）

### 4.1 Move类
参考：《开发文档-战斗系统.md》第6节

在 `move.js` 中：
- [ ] 创建 `Move` 类
- [ ] 实现构造函数（从MOVE_DATA加载）
- [ ] 实现 `getDisplayInfo()` 方法
- [ ] 测试：`new Move('ember')` 能创建火花技能

### 4.2 Pokemon类
参考：《开发文档-战斗系统.md》第5节

在 `pokemon.js` 中：
- [ ] 创建 `Pokemon` 类
- [ ] 实现构造函数（计算属性、加载技能）
- [ ] 实现 `gainExp()` 方法
- [ ] 实现 `levelUp()` 方法
- [ ] 实现 `checkLearnMove()` 方法
- [ ] 实现 `checkEvolution()` 方法
- [ ] 实现 `evolve()` 方法
- [ ] 实现 `calculateExpToNext()` 方法
- [ ] 实现 `fullHeal()` 方法
- [ ] 测试：在Console创建一只1级小火龙
  ```javascript
  const charmander = new Pokemon('charmander', 1);
  console.log(charmander);  // 应该显示完整属性
  ```
- [ ] 测试：给它加经验并升级
  ```javascript
  charmander.gainExp(5000);
  console.log(charmander.level);  // 应该>1
  ```

### 4.3 Battle类
参考：《开发文档-战斗系统.md》第2节

在 `battle.js` 中：
- [ ] 创建 `Battle` 类
- [ ] 实现构造函数
- [ ] 实现 `start()` 方法
- [ ] 实现 `executeTurn()` 方法
- [ ] 实现 `executeMove()` 方法
- [ ] 实现 `executeAttackMove()` 方法
- [ ] 实现 `executeSupportMove()` 方法
- [ ] 实现 `getModifiedStat()` 方法
- [ ] 实现 `getTypeEffectiveness()` 方法
- [ ] 实现 `checkBattleEnd()` 方法
- [ ] 实现 `endBattle()` 方法

### 4.4 AI系统
参考：《开发文档-战斗系统.md》第3节

在 `battle.js` 中（可以放在Battle类后面）：
- [ ] 创建 `SimpleAI` 类
- [ ] 实现 `chooseMove()` 静态方法
- [ ] 测试：AI能随机选择技能

### 4.5 野生宝可梦生成函数
参考：《开发文档-战斗系统.md》第4节

在 `battle.js` 中：
- [ ] 实现 `generateWildPokemon(playerLevel)` 函数
- [ ] 测试：生成的宝可梦等级应该在 playerLevel±2 范围内
  ```javascript
  const wild = generateWildPokemon(10);
  console.log(wild.level);  // 应该在8-12之间
  ```

---

## 📁 阶段5：实现游戏状态管理（1天）

### 5.1 创建游戏状态对象
参考：《开发文档-数据结构设计.md》第6节

在 `gameState.js` 中：
- [ ] 创建 `gameState` 对象
- [ ] 添加 `player` 对象（pokemon、battlesWon、totalBattles）
- [ ] 添加 `battle` 对象（isActive、instance、wildPokemon）
- [ ] 添加 `phase` 字段（'start'、'main'、'battle'）

### 5.2 实现保存/读取功能
参考：《开发文档-数据结构设计.md》第7节

- [ ] 实现 `saveGame()` 函数（使用localStorage）
- [ ] 实现 `loadGame()` 函数
- [ ] 测试：调用saveGame()，刷新页面，调用loadGame()应该恢复状态

---

## 📁 阶段6：实现UI控制（2-3天）

### 6.1 创建UI模块
参考：《开发文档-前端界面开发.md》第3节

在 `ui.js` 中：
- [ ] 创建 `UI` 对象
- [ ] 实现 `showScreen(screenId)` 方法
- [ ] 实现 `updatePlayerStatus(pokemon)` 方法
- [ ] 实现 `showMessage(text)` 方法
- [ ] 实现 `addBattleLog(text, cssClass)` 方法
- [ ] 实现 `clearBattleLog()` 方法
- [ ] 实现 `updateBattleStatus(player, wild)` 方法
- [ ] 实现 `createMoveButtons(moves, callback)` 方法
- [ ] 实现 `setMoveButtonsEnabled(enabled)` 方法
- [ ] 实现 `updateStats(wins, total)` 方法

### 6.2 测试UI功能
在Console中测试：
- [ ] `UI.showMessage('测试消息')` 能在消息框显示
- [ ] `UI.addBattleLog('测试日志')` 能在战斗日志显示
- [ ] `UI.showScreen('main-screen')` 能切换界面

---

## 📁 阶段7：实现主程序流程（2-3天）

### 7.1 初始化游戏
参考：《开发文档-战斗系统.md》第7节

在 `main.js` 中：
- [ ] 实现页面加载时的初始化逻辑
- [ ] 尝试读取存档（loadGame）
- [ ] 如果没有存档，显示初始选择界面
- [ ] 如果有存档，直接进入主界面

### 7.2 初始选择流程
- [ ] 为3个初始宝可梦按钮添加点击事件
- [ ] 点击后创建对应的Pokemon对象
- [ ] 保存到 `gameState.player.pokemon`
- [ ] 切换到主界面
- [ ] 更新玩家状态显示
- [ ] 显示欢迎消息

### 7.3 主界面功能
- [ ] 为"开始战斗"按钮添加点击事件
- [ ] 点击后：
  - [ ] 生成野生宝可梦
  - [ ] 创建Battle实例
  - [ ] 切换到战斗界面
  - [ ] 调用 `battle.start()`
  - [ ] 生成技能按钮
- [ ] 为"宝可梦中心"按钮添加点击事件（可选，暂时只显示消息）

### 7.4 战斗流程
- [ ] 实现 `onPlayerMoveSelected(move)` 函数
- [ ] 点击技能按钮时：
  - [ ] 禁用所有技能按钮
  - [ ] AI选择技能
  - [ ] 调用 `battle.executeTurn(playerMove, aiMove)`
  - [ ] 如果战斗未结束，重新启用技能按钮
  - [ ] 如果战斗结束，等待3秒后返回主界面

### 7.5 自动保存
- [ ] 在战斗结束后调用 `saveGame()`
- [ ] 在升级后调用 `saveGame()`
- [ ] 在进化后调用 `saveGame()`

---

## 📁 阶段8：完整测试（1-2天）

### 8.1 功能测试
- [ ] 测试1：选择小火龙，能进入游戏
- [ ] 测试2：点击"开始战斗"，能遇到野生宝可梦
- [ ] 测试3：点击技能按钮，能看到战斗过程
- [ ] 测试4：击败野生宝可梦，能获得经验
- [ ] 测试5：战斗结束后HP自动回满
- [ ] 测试6：多次战斗后能升级
- [ ] 测试7：升到16级能进化成火恐龙
- [ ] 测试8：进化后属性提升
- [ ] 测试9：刷新页面后进度还在（localStorage）
- [ ] 测试10：战绩统计正确

### 8.2 属性相克测试
- [ ] 用小火龙打绿毛虫（草系），伤害应该翻倍
- [ ] 用小火龙打杰尼龟（水系），伤害应该减半
- [ ] 用皮卡丘（电系）打飞行系，伤害应该翻倍

### 8.3 辅助技能测试
- [ ] 使用"摇尾巴"，对手防御应该降低
- [ ] 使用"缩入壳中"，自己防御应该提升
- [ ] 能力等级变化应该正确显示在日志中

### 8.4 边界情况测试
- [ ] HP降到0时战斗应该结束
- [ ] 等级上限50级（给足够经验不会超过50级）
- [ ] 技能槽满了（4个）不能再学
- [ ] 连续战败多次，游戏不会崩溃

### 8.5 跨端测试
- [ ] 在电脑Chrome浏览器测试
- [ ] 在手机浏览器测试
- [ ] 在平板测试（可选）
- [ ] 确保所有按钮在触摸屏上可点击
- [ ] 确保文字在小屏幕上清晰可读

### 8.6 性能测试
- [ ] 连续战斗20次，游戏应该流畅
- [ ] 战斗日志太长时应该能滚动
- [ ] 没有内存泄漏（打开Chrome性能监视器观察）

---

## 📁 阶段9：优化和润色（1-2天）

### 9.1 用户体验优化
- [ ] 添加按钮点击音效（可选）
- [ ] 添加战斗音效（可选）
- [ ] 优化战斗日志显示速度（逐条显示而非瞬间全部）
- [ ] 添加HP条颜色变化（低于50%变黄，低于20%变红）
- [ ] 添加升级时的闪烁动画
- [ ] 添加进化时的特殊动画

### 9.2 界面美化
- [ ] 调整颜色方案，确保护眼
- [ ] 调整间距，确保不拥挤
- [ ] 添加宝可梦像素图标（可选，可以用emoji代替）
- [ ] 统一按钮风格

### 9.3 代码优化
- [ ] 添加代码注释
- [ ] 移除console.log调试语句
- [ ] 统一命名规范
- [ ] 提取重复代码为函数

---

## 📁 阶段10：部署和分享（0.5天）

### 10.1 本地测试
- [ ] 清空localStorage，重新完整测试一遍
- [ ] 确保没有Console错误
- [ ] 确保所有功能正常

### 10.2 部署到线上（可选）
选择以下任一方式：

**方式A：GitHub Pages（免费）**
- [ ] 创建GitHub账号
- [ ] 创建仓库 `pokemon-game`
- [ ] 上传所有文件
- [ ] 在仓库设置中启用GitHub Pages
- [ ] 访问 `https://你的用户名.github.io/pokemon-game`

**方式B：Vercel（免费）**
- [ ] 注册Vercel账号
- [ ] 连接GitHub仓库
- [ ] 自动部署
- [ ] 获得唯一链接

**方式C：Netlify（免费）**
- [ ] 注册Netlify账号
- [ ] 拖拽文件夹上传
- [ ] 自动部署

### 10.3 分享游戏
- [ ] 复制游戏链接
- [ ] 分享给朋友测试
- [ ] 收集反馈
- [ ] 迭代改进

---

## 🎯 完成标志

当你完成以下所有检查，MVP版本就大功告成了！

- ✅ 能选择御三家并开始游戏
- ✅ 能进行1V1对战，使用攻击和辅助技能
- ✅ 伤害计算正确，属性克制生效
- ✅ 战斗结束后自动回血
- ✅ 能获得经验、升级、进化
- ✅ 手机和电脑都能流畅玩
- ✅ 游戏进度能保存

---

## 📈 后续扩展（可选）

如果你想继续完善游戏，可以考虑：

### 扩展内容
- [ ] 添加更多宝可梦（目标：50只）
- [ ] 添加更多技能（目标：50个）
- [ ] 添加双属性宝可梦的复合克制计算
- [ ] 添加特殊效果技能（中毒、麻痹、睡眠等）

### 新功能
- [ ] 道馆挑战模式（8个道馆馆主）
- [ ] 技能替换功能（在宝可梦中心）
- [ ] 成就系统（击败100只宝可梦等）
- [ ] 排行榜（本地最高等级记录）
- [ ] 稀有宝可梦系统（闪光宝可梦）

### 进阶功能
- [ ] 在线对战（需要后端服务器）
- [ ] 宝可梦交换（需要后端）
- [ ] 自定义队伍（携带6只宝可梦）
- [ ] 背包系统（携带恢复道具）

---

## 🆘 遇到问题怎么办？

### 常见问题排查

**问题1：页面打不开**
- 检查文件路径是否正确
- 检查文件名拼写
- 用浏览器打开开发者工具查看错误

**问题2：JavaScript不生效**
- 检查script标签顺序（data.js必须在最前面）
- 检查Console是否有红色错误
- 检查语法（括号、分号、引号是否匹配）

**问题3：样式不显示**
- 检查CSS文件路径
- 检查class名是否拼写正确
- 用浏览器检查元素，看CSS是否加载

**问题4：战斗逻辑出错**
- 在关键位置添加 `console.log()` 查看变量值
- 逐步调试，找到出错的函数
- 对照文档检查代码

**问题5：数据不保存**
- 检查localStorage是否被浏览器禁用
- 检查saveGame()是否被调用
- 在Console输入 `localStorage.getItem('pokemonSave')` 查看数据

---

## 🎓 学习资源

- **MDN Web文档**：https://developer.mozilla.org/zh-CN/
- **JavaScript教程**：https://javascript.info/
- **CSS技巧**：https://css-tricks.com/
- **宝可梦数据**：https://wiki.52poke.com/

---

**祝你开发顺利！一步一个脚印，你一定能做出自己的宝可梦游戏！** 🎮✨

---

## 📁 v3.0 已完成功能详解

以下是在MVP基础上新增的v3.0功能，**已全部完成并测试**。

### ✅ 阶段11：道具系统（已完成）

**文件**：`scripts/item.js`

**已实现内容**：
- ✅ Item类定义（id、name、type、effect、price、description）
- ✅ 药品类道具（4种）：
  - ✅ 伤药（300💰，恢复20HP）
  - ✅ 好伤药（700💰，恢复50HP）
  - ✅ 超级伤药（1200💰，恢复200HP）
  - ✅ 全满药（2500💰，完全恢复HP）
- ✅ 精灵球类道具（4种）：
  - ✅ 精灵球（200💰，捕捉率1.0x）
  - ✅ 超级球（600💰，捕捉率1.5x）
  - ✅ 高级球（1200💰，捕捉率2.0x）
  - ✅ 大师球（99999💰，必定成功）
- ✅ 道具使用逻辑（useMedicine、HP检查、效果计算）
- ✅ 道具工厂函数（createItem、getMedicineItems、getPokeballItems）

---

### ✅ 阶段12：商店系统（已完成）

**文件**：`scripts/shop.js`

**已实现内容**：
- ✅ 商店UI渲染（renderShop、renderMedicineItems、renderPokeballItems）
- ✅ 商品卡片生成（显示图标、名称、描述、价格、已拥有数量）
- ✅ 购买逻辑（buyItem）：
  - ✅ 金币检查
  - ✅ 金币扣除
  - ✅ 道具添加到背包
  - ✅ UI实时更新
  - ✅ 购买成功/失败提示
- ✅ 批量购买功能（buyItemBulk，支持一次购买多个）
- ✅ 动态消息提示系统（showShopMessage，3秒自动消失）
- ✅ 金币显示同步（商店界面和主界面）

**UI位置**：主界面 → 商店Tab

---

### ✅ 阶段13：队伍和背包管理（已完成）

**文件**：`scripts/gameState.js` (v3.0升级)

**已实现内容**：
- ✅ 队伍系统：
  - ✅ pokemonTeam数组（最多6只）
  - ✅ activePokemonIndex（当前出战宝可梦索引）
  - ✅ getCurrentPokemon()（获取当前出战宝可梦）
  - ✅ addPokemonToTeam()（添加到队伍）
  - ✅ removePokemonFromTeam()（移至盒子）
  - ✅ switchActivePokemon()（切换出战）
  - ✅ hasAlivePokemon()（检查是否还有可战斗宝可梦）
  - ✅ switchToNextAlivePokemon()（自动切换到下一个活着的）

- ✅ 背包系统：
  - ✅ bag对象（{itemId: count}格式）
  - ✅ addItem()（添加道具）
  - ✅ removeItem()（移除道具）
  - ✅ getItemCount()（获取数量）
  - ✅ useItem()（使用道具，调用Item.use()）

- ✅ 盒子系统：
  - ✅ pokemonBox数组（无限容量）
  - ✅ addPokemonToBox()（捕获后添加）
  - ✅ movePokemonToTeam()（从盒子移到队伍）
  - ✅ capturedCount统计（总捕获数）

- ✅ 存档兼容性：
  - ✅ v3.0存档格式（保存队伍、盒子、背包）
  - ✅ loadLegacySave()（自动迁移v2.0存档）
  - ✅ 迁移时赠送新手礼包（5个伤药 + 5个精灵球）

---

### ✅ 阶段14：捕捉系统（已完成）

**文件**：`scripts/battle.js` (扩展)

**已实现内容**：
- ✅ 捕捉率计算（calculateCatchRate）：
  - ✅ HP因子：(maxHP × 3 - currentHP × 2) / (maxHP × 3)
  - ✅ 等级因子：(50 - level) / 50
  - ✅ 综合公式：(HP因子 × 0.6 + 等级因子 × 0.4) × 球倍率
  - ✅ 捕捉率范围：5%-95%（大师球100%）
  - ✅ 特殊处理：大师球必定成功

- ✅ 投掷精灵球逻辑（throwPokeball）：
  - ✅ 检查战斗类型（只能在野生战斗使用）
  - ✅ 扣除精灵球
  - ✅ 计算捕捉成功率
  - ✅ 捕捉动画提示（"精灵球晃动了一下..."）
  - ✅ 成功判定
  - ✅ 队伍未满 → 加入队伍
  - ✅ 队伍已满 → 传送到盒子
  - ✅ 战斗结束处理

- ✅ 逃跑功能（flee）：
  - ✅ 野生战斗可逃跑
  - ✅ 训练家战斗禁止逃跑
  - ✅ 逃跑成功后返回主界面

---

### ✅ 阶段15：战斗中使用道具（已完成）

**文件**：`scripts/battle.js` (扩展)

**已实现内容**：
- ✅ 使用药品（useMedicine）：
  - ✅ 检查道具数量
  - ✅ 恢复当前宝可梦HP
  - ✅ 扣除道具
  - ✅ 显示恢复量
  - ✅ 对手回合（使用道具算一回合）
  - ✅ 更新UI显示

- ✅ 战斗道具UI（renderBattleItemList）：
  - ✅ 显示所有可用道具
  - ✅ 显示拥有数量
  - ✅ 药品：显示恢复量
  - ✅ 精灵球：仅在野生战斗显示
  - ✅ 点击道具自动使用
  - ✅ 使用后关闭道具面板

---

### ✅ 阶段16：UI增强（已完成）

**文件**：`scripts/ui.js` (大幅扩展)

**已实现内容**：
- ✅ 背包UI（renderBag、renderBagItems）：
  - ✅ 显示宝可梦队伍（renderPokemonTeam）
  - ✅ 队伍卡片（HP条、等级、图标）
  - ✅ 当前出战宝可梦高亮显示（蓝色边框）
  - ✅ 切换出战功能（非战斗时）
  - ✅ 移至盒子功能（需保留至少1只）
  - ✅ 道具列表显示（图标、名称、数量）
  - ✅ 使用道具功能（选择目标宝可梦）

- ✅ 盒子UI（renderPokemonBox）：
  - ✅ 显示所有盒子中的宝可梦
  - ✅ 宝可梦卡片（HP状态、等级）
  - ✅ 移至队伍功能（队伍未满时）
  - ✅ 盒子数量统计

- ✅ 战斗UI增强：
  - ✅ 战斗中道具按钮（"🎒 使用道具"）
  - ✅ 逃跑按钮（"🏃 逃跑"）
  - ✅ 道具选择面板（renderBattleItemList）
  - ✅ 道具过滤（药品总是显示，精灵球仅野生战斗）

- ✅ 宝可梦图标系统（getPokemonIcon）：
  - ✅ 151只宝可梦完整图标映射
  - ✅ 使用emoji表示不同属性
  - ✅ 御三家系列：🔥🌱💧
  - ✅ 传说宝可梦：特殊图标
  - ✅ 未知宝可梦：❓占位符

**文件**：`index.html` (UI结构更新)

**已实现内容**：
- ✅ 商店Tab结构：
  - ✅ 金币显示区域
  - ✅ 药品容器（medicine-items-container）
  - ✅ 精灵球容器（pokeball-items-container）

- ✅ 背包Tab结构：
  - ✅ 宝可梦队伍容器（pokemon-team-container）
  - ✅ 道具容器（bag-items-container）

- ✅ 服务Tab结构：
  - ✅ 宝可梦中心（恢复全队HP）
  - ✅ 盒子管理按钮
  - ✅ 盒子面板（pokemon-box-container）
  - ✅ 保存游戏按钮

- ✅ 战斗界面结构：
  - ✅ 道具按钮
  - ✅ 逃跑按钮
  - ✅ 道具选择面板（battle-item-panel）

**文件**：`styles.css` (样式增强)

**已实现内容**：
- ✅ 淡入动画（@keyframes fadeIn）
- ✅ 消息提示样式（animate-fade-in）
- ✅ 模态框样式（modal-overlay）
- ✅ 自定义滚动条样式
- ✅ 宝可梦卡片样式
- ✅ 高亮效果（当前出战宝可梦）

---

### ✅ 阶段17：主程序集成（已完成）

**文件**：`scripts/main.js` (更新)

**已实现内容**：
- ✅ 初始化新手礼包：
  - ✅ 选择御三家后赠送5个伤药
  - ✅ 选择御三家后赠送5个精灵球
  - ✅ 显示礼包获得提示

- ✅ 事件绑定：
  - ✅ 商店Tab切换（renderShop）
  - ✅ 背包Tab切换（renderBag）
  - ✅ 服务Tab切换（renderPokemonBox）
  - ✅ 宝可梦中心按钮（恢复全队HP）
  - ✅ 盒子管理按钮（显示/隐藏）
  - ✅ 战斗道具按钮（显示道具列表）
  - ✅ 逃跑按钮（flee）

- ✅ 战斗结束处理：
  - ✅ 捕捉成功后显示提示
  - ✅ 队伍满时自动传送到盒子
  - ✅ 更新盒子数量显示
  - ✅ 逃跑成功返回主界面

---

### ✅ 阶段18：测试和优化（已完成）

**已测试内容**：
- ✅ 商店购买功能（金币检查、道具添加）
- ✅ 道具使用（战斗中/非战斗）
- ✅ 捕捉系统（捕捉率计算、成功/失败）
- ✅ 队伍管理（添加、移除、切换）
- ✅ 盒子系统（存储、取出）
- ✅ 存档兼容性（v2.0自动升级到v3.0）
- ✅ 新手礼包发放
- ✅ 151只宝可梦图标显示
- ✅ 响应式布局（电脑/手机）
- ✅ 逃跑功能（野生可逃，训练家不可逃）

**已优化内容**：
- ✅ UI实时更新（金币、道具数量、HP）
- ✅ 消息提示动画（3秒淡出）
- ✅ 捕捉动画（"精灵球晃动..."）
- ✅ 宝可梦卡片样式统一
- ✅ 滚动条美化
- ✅ 错误处理（金币不足、道具不足、队伍已满）

---

## 📊 v3.0 技术统计

### 代码量变化
- `scripts/item.js`：**172行**（新增）
- `scripts/shop.js`：**221行**（新增）
- `scripts/gameState.js`：135行 → **407行**（+272行）
- `scripts/battle.js`：458行 → **635行**（+177行）
- `scripts/ui.js`：166行 → **665行**（+499行）
- `scripts/main.js`：259行 → **297行**（+38行）
- `index.html`：UI结构大幅扩展
- `styles.css`：新增约80行动画和样式

**总新增代码**：约 **1400+行**

### 数据扩展
- **道具种类**：0 → 8种
- **宝可梦图标**：0 → 151个
- **队伍容量**：1只 → 6只
- **盒子容量**：0 → 无限
- **存档版本**：v2.0 → v3.0

---

## 🎯 v3.0 完成标志

当前版本已达成以下所有目标：

- ✅ 玩家可以在商店购买道具
- ✅ 玩家可以在战斗中使用药品和精灵球
- ✅ 玩家可以捕捉野生宝可梦（捕捉率合理）
- ✅ 队伍最多携带6只宝可梦
- ✅ 捕捉的宝可梦可存入盒子
- ✅ 可从盒子取出宝可梦到队伍
- ✅ 可切换出战宝可梦
- ✅ 新玩家获得新手礼包
- ✅ 旧存档自动迁移到v3.0
- ✅ 151只宝可梦都有图标
- ✅ 手机和电脑都流畅运行

---

## 📈 v4.0 规划（未来功能）

以下功能尚未实现，可作为后续开发方向：

### 图鉴系统
- [ ] 显示捕获过的宝可梦
- [ ] 显示捕获率（已捕获/总数）
- [ ] 按属性、编号筛选
- [ ] 查看宝可梦详细信息

### 道馆挑战
- [ ] 8个道馆馆主
- [ ] 馆主使用特定属性队伍
- [ ] 徽章收集系统
- [ ] 通关后奖励

### 更多道具
- [ ] 状态恢复道具（解除中毒、麻痹）
- [ ] 能力提升道具（攻击强化、防御强化）
- [ ] 进化石（强制进化特定宝可梦）
- [ ] 稀有糖果（直接升级）

### 成就系统
- [ ] 击败100只宝可梦
- [ ] 捕获50只宝可梦
- [ ] 升到50级
- [ ] 击败所有道馆馆主
- [ ] 成就奖励（金币、道具）

### 音效和音乐
- [ ] 背景音乐（主界面、战斗）
- [ ] 音效（攻击、升级、捕捉成功）
- [ ] 音量控制

### 宝可梦像素图
- [ ] 替换emoji为像素图标
- [ ] 战斗动画效果
- [ ] 进化动画

---

## 🔧 维护指南

### 添加新道具
1. 在 `scripts/item.js` 的 `ITEM_DATA` 中添加道具定义
2. 如果是新类型道具，在 `Item.use()` 中添加处理逻辑
3. 在 `scripts/shop.js` 中确保新道具会被渲染（药品/精灵球分类）

### 添加新宝可梦
1. 在 `scripts/data.js` 的 `POKEMON_DATA` 中添加数据
2. 在 `scripts/ui.js` 的 `getPokemonIcon()` 中添加图标
3. 如果是野生宝可梦，在 `WILD_POKEMON_POOL` 中添加

### 调整捕捉率
修改 `scripts/battle.js` 的 `calculateCatchRate()` 函数：
- 调整 `hpFactor` 权重（当前0.6）
- 调整 `levelFactor` 权重（当前0.4）
- 调整最小/最大捕捉率（当前5%-95%）

### 调整道具价格
修改 `scripts/item.js` 的 `ITEM_DATA` 中对应道具的 `price` 字段

---

**v3.0开发完成！所有核心功能已实现并测试通过。** ✨🎮

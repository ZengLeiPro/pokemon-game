# ã€Šå…³éƒ½æ–‡å­—å¯¹æˆ˜ã€‹æˆ˜æ–—ç³»ç»Ÿå¼€å‘æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

è¿™ä»½æ–‡æ¡£è¯¦ç»†è¯´æ˜æ¸¸æˆçš„æ ¸å¿ƒâ€”â€”æˆ˜æ–—ç³»ç»Ÿçš„æ‰€æœ‰é€»è¾‘ã€‚

**å°±åƒå›½é™…è±¡æ£‹çš„è§„åˆ™ä¹¦**ï¼š
- ä»€ä¹ˆæ—¶å€™è§¦å‘æˆ˜æ–—
- æ¯ä¸ªå›åˆæ€ä¹ˆæ‰§è¡Œ
- ä¼¤å®³æ€ä¹ˆè®¡ç®—
- ä»€ä¹ˆæ—¶å€™åˆ†èƒœè´Ÿ

---

## 1ï¸âƒ£ æˆ˜æ–—ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒæµç¨‹å›¾

```
ç©å®¶ç‚¹å‡»"å¼€å§‹æˆ˜æ–—"
    â†“
ç”Ÿæˆé‡ç”Ÿå®å¯æ¢¦ï¼ˆç­‰çº§Â±2ï¼‰
    â†“
æ˜¾ç¤º"é‡ç”Ÿçš„XXå‡ºç°äº†ï¼"
    â†“
ã€å›åˆå¼€å§‹ã€‘
    â†“
ç©å®¶é€‰æ‹©æŠ€èƒ½ï¼ˆç‚¹å‡»æŒ‰é’®ï¼‰
    â†“
AIé€‰æ‹©æŠ€èƒ½ï¼ˆéšæœº/æ™ºèƒ½ï¼‰
    â†“
æ¯”è¾ƒé€Ÿåº¦ï¼ˆè°å¿«è°å…ˆæ”»å‡»ï¼‰
    â†“
å…ˆæ”»æ–¹æ‰§è¡ŒæŠ€èƒ½
    â†“
åæ”»æ–¹æ‰§è¡ŒæŠ€èƒ½ï¼ˆå¦‚æœæ²¡å€’ä¸‹ï¼‰
    â†“
æ£€æŸ¥èƒœè´Ÿ
    â†“
å¦‚æœåˆ†å‡ºèƒœè´Ÿ â†’ æˆ˜æ–—ç»“æŸ â†’ è‡ªåŠ¨å›è¡€ â†’ åˆ†å‘ç»éªŒ
å¦‚æœæœªåˆ†å‡ºèƒœè´Ÿ â†’ ã€å›åˆå¼€å§‹ã€‘ï¼ˆå¾ªç¯ï¼‰
```

---

## 2ï¸âƒ£ Battleç±»è®¾è®¡

### å®Œæ•´çš„battle.jsä»£ç 

```javascript
class Battle {
  constructor(playerPokemon, wildPokemon) {
    this.playerPokemon = playerPokemon;
    this.wildPokemon = wildPokemon;
    this.turn = 0;                  // å½“å‰å›åˆæ•°
    this.isActive = true;           // æˆ˜æ–—æ˜¯å¦è¿›è¡Œä¸­
    this.winner = null;             // èƒœè€…ï¼ˆ'player' æˆ– 'wild'ï¼‰
  }

  // ========== å¼€å§‹æˆ˜æ–— ==========
  start() {
    this.turn = 0;
    this.isActive = true;
    this.winner = null;

    // é‡ç½®èƒ½åŠ›ç­‰çº§å˜åŒ–ï¼ˆæˆ˜æ–—å¼€å§‹æ—¶æ¸…é›¶ï¼‰
    this.playerPokemon.statModifiers = { attack: 0, defense: 0 };
    this.wildPokemon.statModifiers = { attack: 0, defense: 0 };

    // æ˜¾ç¤ºé­é‡æ–‡å­—
    UI.clearBattleLog();
    UI.addBattleLog(`é‡ç”Ÿçš„ ${this.wildPokemon.name} Lv.${this.wildPokemon.level} å‡ºç°äº†ï¼`);
    UI.addBattleLog(`ä½ çš„ ${this.playerPokemon.name} Lv.${this.playerPokemon.level} å‡†å¤‡æˆ˜æ–—ï¼`);
    UI.updateBattleStatus(this.playerPokemon, this.wildPokemon);
  }

  // ========== æ‰§è¡Œå›åˆ ==========
  executeTurn(playerMove, aiMove) {
    this.turn++;
    UI.addBattleLog(`\n--- ç¬¬ ${this.turn} å›åˆ ---`);

    // å†³å®šè¡ŒåŠ¨é¡ºåºï¼ˆé€Ÿåº¦å¿«çš„å…ˆæ”»å‡»ï¼‰
    const playerSpeed = this.playerPokemon.speed || 50;  // MVPç‰ˆå¯ä»¥ç®€åŒ–ä¸ºå›ºå®šå€¼
    const wildSpeed = this.wildPokemon.speed || 50;

    let firstAttacker, firstMove, secondAttacker, secondMove;

    if (playerSpeed >= wildSpeed) {
      firstAttacker = this.playerPokemon;
      firstMove = playerMove;
      secondAttacker = this.wildPokemon;
      secondMove = aiMove;
    } else {
      firstAttacker = this.wildPokemon;
      firstMove = aiMove;
      secondAttacker = this.playerPokemon;
      secondMove = playerMove;
    }

    // å…ˆæ”»æ–¹è¡ŒåŠ¨
    this.executeMove(firstAttacker, secondAttacker, firstMove);

    // æ£€æŸ¥æˆ˜æ–—æ˜¯å¦ç»“æŸ
    if (this.checkBattleEnd()) {
      return this.endBattle();
    }

    // åæ”»æ–¹è¡ŒåŠ¨
    this.executeMove(secondAttacker, firstAttacker, secondMove);

    // å†æ¬¡æ£€æŸ¥æˆ˜æ–—æ˜¯å¦ç»“æŸ
    if (this.checkBattleEnd()) {
      return this.endBattle();
    }

    // æ›´æ–°UI
    UI.updateBattleStatus(this.playerPokemon, this.wildPokemon);
  }

  // ========== æ‰§è¡Œå•ä¸ªæŠ€èƒ½ ==========
  executeMove(attacker, defender, move) {
    const attackerName = attacker === this.playerPokemon ?
      `ä½ çš„ ${attacker.name}` : `é‡ç”Ÿçš„ ${attacker.name}`;

    UI.addBattleLog(`${attackerName} ä½¿ç”¨äº† ${move.name}ï¼`);

    if (move.category === 'attack') {
      // æ”»å‡»æŠ€èƒ½
      this.executeAttackMove(attacker, defender, move);
    } else if (move.category === 'support') {
      // è¾…åŠ©æŠ€èƒ½
      this.executeSupportMove(attacker, defender, move);
    }
  }

  // ========== æ‰§è¡Œæ”»å‡»æŠ€èƒ½ ==========
  executeAttackMove(attacker, defender, move) {
    // 1. è®¡ç®—åŸºç¡€ä¼¤å®³
    const attackStat = this.getModifiedStat(attacker, 'attack');
    const defenseStat = this.getModifiedStat(defender, 'defense');

    let baseDamage = (attackStat * move.power) / defenseStat;

    // 2. å±æ€§å…‹åˆ¶å€æ•°
    const typeMultiplier = this.getTypeEffectiveness(move.type, defender.type);

    // 3. éšæœºç³»æ•°ï¼ˆ0.85 - 1.0ï¼‰
    const randomFactor = 0.85 + Math.random() * 0.15;

    // 4. æœ€ç»ˆä¼¤å®³ï¼ˆå‘ä¸‹å–æ•´ï¼Œæœ€å°‘1ç‚¹ï¼‰
    let finalDamage = Math.floor(baseDamage * typeMultiplier * randomFactor);
    finalDamage = Math.max(1, finalDamage);

    // 5. åº”ç”¨ä¼¤å®³
    defender.currentHP -= finalDamage;
    defender.currentHP = Math.max(0, defender.currentHP);  // ä¸èƒ½ä½äº0

    // 6. æ˜¾ç¤ºä¼¤å®³ä¿¡æ¯
    if (typeMultiplier === 2.0) {
      UI.addBattleLog(`æ•ˆæœç»ä½³ï¼é€ æˆ ${finalDamage} ç‚¹ä¼¤å®³ï¼`, 'critical');
    } else if (typeMultiplier === 0.5) {
      UI.addBattleLog(`æ•ˆæœä¸å¥½...é€ æˆ ${finalDamage} ç‚¹ä¼¤å®³`, '');
    } else if (typeMultiplier === 0.0) {
      UI.addBattleLog(`å¯¹ ${defender.name} æ— æ•ˆï¼`, '');
      return;
    } else {
      UI.addBattleLog(`é€ æˆ ${finalDamage} ç‚¹ä¼¤å®³ï¼`);
    }

    // 7. æ˜¾ç¤ºå‰©ä½™HP
    const defenderName = defender === this.playerPokemon ?
      `ä½ çš„ ${defender.name}` : `é‡ç”Ÿçš„ ${defender.name}`;
    UI.addBattleLog(`${defenderName} å‰©ä½™ HP: ${defender.currentHP}/${defender.maxHP}`);
  }

  // ========== æ‰§è¡Œè¾…åŠ©æŠ€èƒ½ ==========
  executeSupportMove(user, opponent, move) {
    const effect = move.effect;
    const target = effect.target === 'self' ? user : opponent;

    // åº”ç”¨èƒ½åŠ›å˜åŒ–
    const oldValue = target.statModifiers[effect.stat];
    target.statModifiers[effect.stat] += effect.modifier;

    // é™åˆ¶èŒƒå›´åœ¨-6åˆ°+6
    target.statModifiers[effect.stat] = Math.max(-6,
      Math.min(6, target.statModifiers[effect.stat]));

    const actualChange = target.statModifiers[effect.stat] - oldValue;

    if (actualChange === 0) {
      UI.addBattleLog(`ä½†æ˜¯æ²¡æœ‰æ•ˆæœï¼`);
      return;
    }

    // æ˜¾ç¤ºå˜åŒ–ä¿¡æ¯
    const targetName = target === this.playerPokemon ?
      `ä½ çš„ ${target.name}` : `é‡ç”Ÿçš„ ${target.name}`;

    const statName = effect.stat === 'attack' ? 'æ”»å‡»' : 'é˜²å¾¡';

    if (actualChange > 0) {
      UI.addBattleLog(`${targetName} çš„ ${statName} æå‡äº†ï¼`, 'success');
    } else {
      UI.addBattleLog(`${targetName} çš„ ${statName} é™ä½äº†ï¼`);
    }
  }

  // ========== è·å–ä¿®æ­£åçš„å±æ€§ ==========
  getModifiedStat(pokemon, statName) {
    const baseValue = pokemon[statName];
    const modifier = pokemon.statModifiers[statName] || 0;

    // èƒ½åŠ›ç­‰çº§å¯¹åº”çš„å€ç‡
    const multipliers = {
      '-6': 0.25, '-5': 0.28, '-4': 0.33, '-3': 0.4, '-2': 0.5, '-1': 0.66,
      '0': 1.0,
      '1': 1.5, '2': 2.0, '3': 2.5, '4': 3.0, '5': 3.5, '6': 4.0
    };

    return Math.floor(baseValue * multipliers[modifier]);
  }

  // ========== å±æ€§å…‹åˆ¶æŸ¥è¯¢ ==========
  getTypeEffectiveness(attackType, defenderTypes) {
    let multiplier = 1.0;

    // éå†é˜²å¾¡æ–¹çš„æ¯ä¸ªå±æ€§
    for (let defType of defenderTypes) {
      if (TYPE_CHART[attackType] && TYPE_CHART[attackType][defType] !== undefined) {
        multiplier *= TYPE_CHART[attackType][defType];
      }
    }

    return multiplier;
  }

  // ========== æ£€æŸ¥æˆ˜æ–—æ˜¯å¦ç»“æŸ ==========
  checkBattleEnd() {
    if (this.wildPokemon.currentHP <= 0) {
      this.winner = 'player';
      return true;
    }

    if (this.playerPokemon.currentHP <= 0) {
      this.winner = 'wild';
      return true;
    }

    return false;
  }

  // ========== æˆ˜æ–—ç»“æŸå¤„ç† ==========
  endBattle() {
    this.isActive = false;

    if (this.winner === 'player') {
      UI.addBattleLog(`\né‡ç”Ÿçš„ ${this.wildPokemon.name} å€’ä¸‹äº†ï¼`, 'success');
      UI.addBattleLog(`æˆ˜æ–—èƒœåˆ©ï¼`, 'success');

      // è®¡ç®—ç»éªŒå€¼
      const expGained = this.wildPokemon.level * 5;
      UI.addBattleLog(`è·å¾— ${expGained} ç‚¹ç»éªŒï¼`, 'success');

      // åŠ ç»éªŒï¼ˆå¯èƒ½ä¼šå‡çº§ï¼‰
      const leveledUp = this.playerPokemon.gainExp(expGained);

      if (leveledUp) {
        UI.addBattleLog(`\n${this.playerPokemon.name} å‡åˆ°äº† Lv.${this.playerPokemon.level}ï¼`, 'success');
        UI.addBattleLog(`HP+${POKEMON_DATA[this.playerPokemon.speciesId].statsGrowth.hp}ï¼Œæ”»å‡»+${POKEMON_DATA[this.playerPokemon.speciesId].statsGrowth.attack}ï¼Œé˜²å¾¡+${POKEMON_DATA[this.playerPokemon.speciesId].statsGrowth.defense}ï¼`);

        // æ£€æŸ¥æ˜¯å¦è¿›åŒ–
        const evolved = this.playerPokemon.checkEvolution();
        if (evolved) {
          UI.addBattleLog(`\nä»€ä¹ˆï¼ï¼Ÿ${this.playerPokemon.name} æ­£åœ¨è¿›åŒ–...`, 'critical');
          // è¿›åŒ–é€»è¾‘åœ¨Pokemonç±»ä¸­å¤„ç†
        }
      }

      // æˆ˜åè‡ªåŠ¨å›è¡€
      this.playerPokemon.currentHP = this.playerPokemon.maxHP;
      UI.addBattleLog(`\næˆ˜æ–—ç»“æŸï¼ä½ çš„ ${this.playerPokemon.name} HPå·²å®Œå…¨æ¢å¤è‡³ ${this.playerPokemon.maxHP}/${this.playerPokemon.maxHP}ï¼`, 'success');

      // æ›´æ–°æˆ˜ç»©
      gameState.player.battlesWon++;
      gameState.player.totalBattles++;

    } else {
      UI.addBattleLog(`\nä½ çš„ ${this.playerPokemon.name} å€’ä¸‹äº†ï¼`, 'critical');
      UI.addBattleLog(`æˆ˜æ–—å¤±è´¥ï¼`);

      // å¤±è´¥ä¹Ÿå›è¡€
      this.playerPokemon.currentHP = this.playerPokemon.maxHP;
      UI.addBattleLog(`\næˆ˜æ–—ç»“æŸï¼ä½ çš„ ${this.playerPokemon.name} HPå·²å®Œå…¨æ¢å¤è‡³ ${this.playerPokemon.maxHP}/${this.playerPokemon.maxHP}ï¼`);

      // æ›´æ–°æˆ˜ç»©
      gameState.player.totalBattles++;
    }

    // æ›´æ–°UI
    UI.updatePlayerStatus(this.playerPokemon);
    UI.updateStats(gameState.player.battlesWon, gameState.player.totalBattles);

    // 3ç§’åè¿”å›ä¸»ç•Œé¢
    setTimeout(() => {
      UI.showScreen('main-screen');
      UI.showMessage('å‡†å¤‡å¼€å§‹ä¸‹ä¸€åœºæˆ˜æ–—ï¼');
      gameState.battle.isActive = false;
    }, 3000);

    return this.winner;
  }
}
```

---

## 3ï¸âƒ£ AIç³»ç»Ÿè®¾è®¡

### ç®€å•AIï¼ˆMVPç‰ˆï¼‰

```javascript
class SimpleAI {
  // é€‰æ‹©ä¸€ä¸ªéšæœºæŠ€èƒ½
  static chooseMove(pokemon) {
    const moves = pokemon.moves;
    const randomIndex = Math.floor(Math.random() * moves.length);
    return moves[randomIndex];
  }
}
```

### ä¸­ç­‰AIï¼ˆå¯é€‰ï¼‰

```javascript
class MediumAI {
  // ä¼˜å…ˆé€‰æ‹©å…‹åˆ¶å¯¹æ‰‹çš„æ”»å‡»æŠ€èƒ½
  static chooseMove(pokemon, opponent) {
    const moves = pokemon.moves;

    // æ‰¾å‡ºå…‹åˆ¶å¯¹æ‰‹çš„æ”»å‡»æŠ€èƒ½
    const effectiveMoves = moves.filter(move => {
      if (move.category !== 'attack') return false;
      const effectiveness = battle.getTypeEffectiveness(move.type, opponent.type);
      return effectiveness > 1.0;
    });

    if (effectiveMoves.length > 0) {
      // å¦‚æœæœ‰å…‹åˆ¶æŠ€èƒ½ï¼Œéšæœºé€‰ä¸€ä¸ª
      return effectiveMoves[Math.floor(Math.random() * effectiveMoves.length)];
    }

    // å¦åˆ™éšæœºé€‰ä¸€ä¸ªæ”»å‡»æŠ€èƒ½
    const attackMoves = moves.filter(m => m.category === 'attack');
    if (attackMoves.length > 0) {
      return attackMoves[Math.floor(Math.random() * attackMoves.length)];
    }

    // å®åœ¨æ²¡æœ‰æ”»å‡»æŠ€èƒ½å°±éšæœºé€‰
    return moves[Math.floor(Math.random() * moves.length)];
  }
}
```

---

## 4ï¸âƒ£ é‡ç”Ÿå®å¯æ¢¦ç”Ÿæˆç³»ç»Ÿ

### generateWildPokemonå‡½æ•°

```javascript
function generateWildPokemon(playerLevel) {
  // 1. ç¡®å®šç­‰çº§èŒƒå›´ï¼ˆç©å®¶ç­‰çº§Â±2ï¼‰
  const minLevel = Math.max(1, playerLevel - 2);
  const maxLevel = Math.min(50, playerLevel + 2);

  // 2. ç­›é€‰ç¬¦åˆç­‰çº§èŒƒå›´çš„å®å¯æ¢¦
  const availablePool = WILD_POKEMON_POOL.filter(entry => {
    return entry.maxLevel >= minLevel && entry.minLevel <= maxLevel;
  });

  if (availablePool.length === 0) {
    // å¦‚æœæ²¡æœ‰ç¬¦åˆçš„ï¼Œé»˜è®¤ç”Ÿæˆä¸€åªå°æ‹‰è¾¾
    return new Pokemon('rattata', playerLevel);
  }

  // 3. åŠ æƒéšæœºé€‰æ‹©
  const totalWeight = availablePool.reduce((sum, entry) => sum + entry.weight, 0);
  let random = Math.random() * totalWeight;

  for (let entry of availablePool) {
    random -= entry.weight;
    if (random <= 0) {
      // 4. éšæœºä¸€ä¸ªå…·ä½“ç­‰çº§
      const wildLevel = minLevel + Math.floor(Math.random() * (maxLevel - minLevel + 1));

      // 5. åˆ›å»ºå®å¯æ¢¦å®ä¾‹
      return new Pokemon(entry.species, wildLevel);
    }
  }

  // å…œåº•ï¼ˆç†è®ºä¸Šä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼‰
  return new Pokemon('rattata', playerLevel);
}
```

---

## 5ï¸âƒ£ Pokemonç±»æ ¸å¿ƒæ–¹æ³•

### pokemon.jså…³é”®ä»£ç 

```javascript
class Pokemon {
  // æ„é€ å‡½æ•°åœ¨"æ•°æ®ç»“æ„è®¾è®¡æ–‡æ¡£"ä¸­å·²å®šä¹‰

  // ========== è·å¾—ç»éªŒ ==========
  gainExp(amount) {
    this.exp += amount;

    // æ£€æŸ¥æ˜¯å¦å‡çº§
    while (this.exp >= this.expToNext && this.level < 50) {
      this.levelUp();
      return true;  // è¿”å›trueè¡¨ç¤ºå‡çº§äº†
    }

    return false;
  }

  // ========== å‡çº§ ==========
  levelUp() {
    this.level++;

    // è·å–æˆé•¿å€¼
    const data = POKEMON_DATA[this.speciesId];
    const growth = data.statsGrowth;

    // æå‡å±æ€§
    this.maxHP += growth.hp;
    this.attack += growth.attack;
    this.defense += growth.defense;

    // å‡çº§æ—¶HPå›æ»¡
    this.currentHP = this.maxHP;

    // é‡æ–°è®¡ç®—ä¸‹ä¸€çº§æ‰€éœ€ç»éªŒ
    this.expToNext = this.calculateExpToNext();

    // æ£€æŸ¥æ˜¯å¦å­¦ä¹ æ–°æŠ€èƒ½
    this.checkLearnMove();

    // æ£€æŸ¥æ˜¯å¦è¿›åŒ–
    this.checkEvolution();
  }

  // ========== æ£€æŸ¥å­¦ä¹ æ–°æŠ€èƒ½ ==========
  checkLearnMove() {
    const data = POKEMON_DATA[this.speciesId];
    const learnset = data.learnset;

    // æ‰¾åˆ°å½“å‰ç­‰çº§å¯ä»¥å­¦ä¹ çš„æŠ€èƒ½
    const newMoves = learnset.filter(entry =>
      entry.level === this.level
    );

    for (let entry of newMoves) {
      const move = new Move(entry.move);

      // å¦‚æœå·²ç»å­¦ä¼šäº†ï¼Œè·³è¿‡
      if (this.moves.some(m => m.id === move.id)) {
        continue;
      }

      // å¦‚æœæŠ€èƒ½æ§½æœªæ»¡ï¼ˆ<4ä¸ªï¼‰ï¼Œç›´æ¥å­¦ä¹ 
      if (this.moves.length < 4) {
        this.moves.push(move);
        UI.addBattleLog(`${this.name} å­¦ä¼šäº† ${move.name}ï¼`, 'success');
      } else {
        // æŠ€èƒ½æ§½å·²æ»¡ï¼ŒMVPç‰ˆæš‚ä¸å¤„ç†ï¼ˆå¯ä»¥åç»­æ·»åŠ æ›¿æ¢é€»è¾‘ï¼‰
        UI.addBattleLog(`${this.name} æƒ³å­¦ä¹  ${move.name}ï¼Œä½†æŠ€èƒ½æ§½å·²æ»¡ï¼`);
      }
    }
  }

  // ========== æ£€æŸ¥è¿›åŒ– ==========
  checkEvolution() {
    const data = POKEMON_DATA[this.speciesId];

    if (!data.evolutions || data.evolutions.length === 0) {
      return false;  // ä¸èƒ½è¿›åŒ–
    }

    // æ£€æŸ¥æ˜¯å¦æ»¡è¶³è¿›åŒ–æ¡ä»¶
    for (let evo of data.evolutions) {
      if (this.level >= evo.level) {
        this.evolve(evo.evolveInto);
        return true;
      }
    }

    return false;
  }

  // ========== è¿›åŒ– ==========
  evolve(newSpeciesId) {
    const oldName = this.name;

    // æ›´æ¢ç‰©ç§
    this.speciesId = newSpeciesId;
    const newData = POKEMON_DATA[newSpeciesId];

    this.name = newData.name;
    this.type = newData.type;

    // å±æ€§æå‡20%ï¼ˆç®€åŒ–å…¬å¼ï¼‰
    this.maxHP = Math.floor(this.maxHP * 1.2);
    this.attack = Math.floor(this.attack * 1.2);
    this.defense = Math.floor(this.defense * 1.2);

    // è¿›åŒ–æ—¶HPå›æ»¡
    this.currentHP = this.maxHP;

    UI.addBattleLog(`\n${oldName} è¿›åŒ–æˆäº† ${this.name}ï¼`, 'critical');
    UI.addBattleLog(`å±æ€§å¤§å¹…æå‡ï¼HP: ${this.maxHP}, æ”»å‡»: ${this.attack}, é˜²å¾¡: ${this.defense}`, 'success');

    // æ£€æŸ¥æ˜¯å¦å­¦ä¹ è¿›åŒ–æŠ€èƒ½
    this.checkLearnMove();
  }

  // ========== è®¡ç®—å‡çº§æ‰€éœ€ç»éªŒ ==========
  calculateExpToNext() {
    if (this.level >= 50) return 999999;
    return EXP_TABLE[this.level + 1] - EXP_TABLE[this.level];
  }

  // ========== æˆ˜æ–—åå›è¡€ ==========
  fullHeal() {
    this.currentHP = this.maxHP;
  }
}
```

---

## 6ï¸âƒ£ Moveç±»è®¾è®¡

### move.jså®Œæ•´ä»£ç 

```javascript
class Move {
  constructor(moveId) {
    const data = MOVE_DATA[moveId];

    if (!data) {
      throw new Error(`æŠ€èƒ½æ•°æ®ä¸å­˜åœ¨: ${moveId}`);
    }

    this.id = moveId;
    this.name = data.name;
    this.nameEn = data.nameEn;
    this.type = data.type;
    this.category = data.category;  // 'attack' æˆ– 'support'
    this.power = data.power || 0;
    this.accuracy = data.accuracy || 100;
    this.pp = data.pp || 999;  // MVPç‰ˆè®¾ä¸ºæ— é™
    this.description = data.description;

    // è¾…åŠ©æŠ€èƒ½ä¸“å±
    if (this.category === 'support') {
      this.effect = data.effect;
    }
  }

  // è·å–æŠ€èƒ½æ˜¾ç¤ºä¿¡æ¯
  getDisplayInfo() {
    if (this.category === 'attack') {
      return `${this.name}ï¼ˆ${this.type}ç³»ï¼Œå¨åŠ›${this.power}ï¼‰`;
    } else {
      return `${this.name}ï¼ˆ${this.description}ï¼‰`;
    }
  }
}
```

---

## 7ï¸âƒ£ æˆ˜æ–—æµç¨‹å®Œæ•´ç¤ºä¾‹

### ä»ç‚¹å‡»"å¼€å§‹æˆ˜æ–—"åˆ°æˆ˜æ–—ç»“æŸ

```javascript
// main.jsä¸­çš„äº‹ä»¶å¤„ç†

// 1. ç‚¹å‡»"å¼€å§‹æˆ˜æ–—"æŒ‰é’®
document.getElementById('battle-btn').addEventListener('click', () => {
  // ç”Ÿæˆé‡ç”Ÿå®å¯æ¢¦
  const wildPokemon = generateWildPokemon(gameState.player.pokemon.level);

  // åˆ›å»ºæˆ˜æ–—å®ä¾‹
  const battle = new Battle(gameState.player.pokemon, wildPokemon);

  // ä¿å­˜åˆ°æ¸¸æˆçŠ¶æ€
  gameState.battle = {
    isActive: true,
    instance: battle,
    wildPokemon: wildPokemon
  };

  // åˆ‡æ¢åˆ°æˆ˜æ–—ç•Œé¢
  UI.showScreen('battle-screen');

  // å¼€å§‹æˆ˜æ–—
  battle.start();

  // ç”ŸæˆæŠ€èƒ½æŒ‰é’®
  UI.createMoveButtons(gameState.player.pokemon.moves, (move) => {
    onPlayerMoveSelected(move);
  });
});

// 2. ç©å®¶é€‰æ‹©æŠ€èƒ½
function onPlayerMoveSelected(playerMove) {
  const battle = gameState.battle.instance;

  // ç¦ç”¨æŠ€èƒ½æŒ‰é’®ï¼ˆé˜²æ­¢é‡å¤ç‚¹å‡»ï¼‰
  UI.setMoveButtonsEnabled(false);

  // AIé€‰æ‹©æŠ€èƒ½
  const aiMove = SimpleAI.chooseMove(gameState.battle.wildPokemon);

  // æ‰§è¡Œå›åˆ
  battle.executeTurn(playerMove, aiMove);

  // å¦‚æœæˆ˜æ–—è¿˜æ²¡ç»“æŸï¼Œé‡æ–°å¯ç”¨æŒ‰é’®
  if (battle.isActive) {
    UI.setMoveButtonsEnabled(true);
  }
}
```

---

## 8ï¸âƒ£ æˆ˜æ–—æ—¥å¿—ç¤ºä¾‹

### ä¸€åœºå®Œæ•´æˆ˜æ–—çš„æ—¥å¿—è¾“å‡º

```
é‡ç”Ÿçš„ ç»¿æ¯›è™« Lv.5 å‡ºç°äº†ï¼
ä½ çš„ å°ç«é¾™ Lv.8 å‡†å¤‡æˆ˜æ–—ï¼

--- ç¬¬ 1 å›åˆ ---
ä½ çš„ å°ç«é¾™ ä½¿ç”¨äº† ç«èŠ±ï¼
æ•ˆæœç»ä½³ï¼é€ æˆ 45 ç‚¹ä¼¤å®³ï¼
é‡ç”Ÿçš„ ç»¿æ¯›è™« å‰©ä½™ HP: 15/60
é‡ç”Ÿçš„ ç»¿æ¯›è™« ä½¿ç”¨äº† æ’å‡»ï¼
é€ æˆ 8 ç‚¹ä¼¤å®³ï¼
ä½ çš„ å°ç«é¾™ å‰©ä½™ HP: 60/68

--- ç¬¬ 2 å›åˆ ---
ä½ çš„ å°ç«é¾™ ä½¿ç”¨äº† ç«èŠ±ï¼
æ•ˆæœç»ä½³ï¼é€ æˆ 42 ç‚¹ä¼¤å®³ï¼
é‡ç”Ÿçš„ ç»¿æ¯›è™« å‰©ä½™ HP: 0/60

é‡ç”Ÿçš„ ç»¿æ¯›è™« å€’ä¸‹äº†ï¼
æˆ˜æ–—èƒœåˆ©ï¼
è·å¾— 25 ç‚¹ç»éªŒï¼

æˆ˜æ–—ç»“æŸï¼ä½ çš„ å°ç«é¾™ HPå·²å®Œå…¨æ¢å¤è‡³ 68/68ï¼
```

---

## 9ï¸âƒ£ æµ‹è¯•ç”¨ä¾‹

### å¿…é¡»é€šè¿‡çš„æµ‹è¯•

```javascript
// æµ‹è¯•1ï¼šä¼¤å®³è®¡ç®—
function testDamageCalculation() {
  const attacker = new Pokemon('charmander', 10);
  const defender = new Pokemon('caterpie', 5);
  const move = new Move('ember');

  const battle = new Battle(attacker, defender);
  const initialHP = defender.currentHP;

  battle.executeAttackMove(attacker, defender, move);

  console.assert(defender.currentHP < initialHP, 'ä¼¤å®³åº”è¯¥ä½¿HPé™ä½');
  console.assert(defender.currentHP >= 0, 'HPä¸èƒ½ä½äº0');
}

// æµ‹è¯•2ï¼šå±æ€§å…‹åˆ¶
function testTypeEffectiveness() {
  const battle = new Battle(null, null);

  const effectiveness1 = battle.getTypeEffectiveness('ç«', ['è‰']);
  console.assert(effectiveness1 === 2.0, 'ç«å…‹è‰åº”è¯¥æ˜¯2å€');

  const effectiveness2 = battle.getTypeEffectiveness('ç«', ['æ°´']);
  console.assert(effectiveness2 === 0.5, 'ç«æ‰“æ°´åº”è¯¥æ˜¯0.5å€');

  const effectiveness3 = battle.getTypeEffectiveness('ç”µ', ['åœ°é¢']);
  console.assert(effectiveness3 === 0.0, 'ç”µæ‰“åœ°é¢åº”è¯¥æ— æ•ˆ');
}

// æµ‹è¯•3ï¼šå‡çº§
function testLevelUp() {
  const pokemon = new Pokemon('charmander', 1);
  const initialLevel = pokemon.level;
  const initialHP = pokemon.maxHP;

  pokemon.gainExp(1000);  // ç»™è¶³å¤Ÿçš„ç»éªŒå‡çº§

  console.assert(pokemon.level > initialLevel, 'åº”è¯¥å‡çº§äº†');
  console.assert(pokemon.maxHP > initialHP, 'HPåº”è¯¥å¢é•¿');
}

// æµ‹è¯•4ï¼šè¿›åŒ–
function testEvolution() {
  const pokemon = new Pokemon('charmander', 15);
  pokemon.gainExp(10000);  // å‡åˆ°16çº§

  console.assert(pokemon.speciesId === 'charmeleon', 'åº”è¯¥è¿›åŒ–æˆç«æé¾™');
  console.assert(pokemon.level >= 16, 'ç­‰çº§åº”è¯¥â‰¥16');
}

// æµ‹è¯•5ï¼šæˆ˜åå›è¡€
function testPostBattleHeal() {
  const player = new Pokemon('charmander', 10);
  const wild = new Pokemon('caterpie', 5);

  player.currentHP = 10;  // æ‰‹åŠ¨é™ä½HP

  const battle = new Battle(player, wild);
  battle.start();

  // æ¨¡æ‹Ÿæˆ˜æ–—...
  wild.currentHP = 0;  // ç›´æ¥è®©å¯¹æ‰‹å€’ä¸‹
  battle.endBattle();

  console.assert(player.currentHP === player.maxHP, 'æˆ˜æ–—ååº”è¯¥æ»¡è¡€');
}

// è¿è¡Œæ‰€æœ‰æµ‹è¯•
testDamageCalculation();
testTypeEffectiveness();
testLevelUp();
testEvolution();
testPostBattleHeal();
console.log('æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');
```

---

## ğŸ¯ æ€»ç»“

è¿™ä»½æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æˆ˜æ–—ç³»ç»Ÿçš„æ‰€æœ‰é€»è¾‘ã€‚

**å…³é”®ç‚¹**ï¼š
- âœ… Battleç±»æ§åˆ¶æ•´ä¸ªæˆ˜æ–—æµç¨‹
- âœ… ä¼¤å®³è®¡ç®—å…¬å¼æ¸…æ™°
- âœ… å±æ€§å…‹åˆ¶ç³»ç»Ÿå®Œæ•´
- âœ… è¾…åŠ©æŠ€èƒ½æ­£ç¡®ä¿®æ”¹èƒ½åŠ›ç­‰çº§
- âœ… æˆ˜åè‡ªåŠ¨å›è¡€
- âœ… ç»éªŒåˆ†å‘å’Œå‡çº§/è¿›åŒ–
- âœ… AIç³»ç»Ÿç®€å•ä½†æœ‰æ•ˆ

**ä¸‹ä¸€æ­¥**ï¼š
- å°†è¿™äº›ä»£ç é›†æˆåˆ°é¡¹ç›®ä¸­
- è¿æ¥UIå’Œæˆ˜æ–—é€»è¾‘
- è¿›è¡Œå®Œæ•´æµ‹è¯•
